<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeForge AI - Smart Code Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <style>
        :root {
            --primary-color: #6366F1;
            --primary-hover: #4F46E5;
            --secondary-color: #10B981;
            --dark-bg: #1E293B;
            --darker-bg: #0F172A;
            --light-text: #E2E8F0;
            --border-color: #334155;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
            color: #334155;
            min-height: 100vh;
        }

        .code-font {
            font-family: 'JetBrains Mono', monospace;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 2rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 2rem;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-hover);
            border-color: var(--primary-hover);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .code-editor {
            background-color: var(--dark-bg);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .code-header {
            background-color: var(--darker-bg);
            padding: 10px 15px;
            color: var(--light-text);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-body {
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .code-body pre {
            margin: 0;
            background: transparent !important;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.25);
        }
        
        .language-badge {
            background-color: rgba(255,255,255,0.1);
            color: var(--light-text);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .feature-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        #codeOutput {
            color: var(--light-text);
            min-height: 200px;
        }
        
        #folderStructure {
            font-family: 'JetBrains Mono', monospace;
            color: var(--light-text);
            background-color: var(--dark-bg);
            padding: 15px;
            border-radius: 10px;
        }

        .footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            background-color: #f1f5f9;
            border-top: 1px solid #e2e8f0;
        }

        /* Add styles for the language select dropdown with search */
        .language-select-container {
            position: relative;
        }
        
        .language-search {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 5px;
        }
        
        .language-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: white;
            position: absolute;
            width: 100%;
            z-index: 1000;
            display: none;
        }
        
        .language-list.show {
            display: block;
        }
        
        .language-item {
            padding: 8px 16px;
            cursor: pointer;
        }
        
        .language-item:hover {
            background-color: #f0f0f0;
        }
        
        .language-item.popular {
            font-weight: bold;
        }
        
        .language-category {
            padding: 8px 16px;
            font-weight: bold;
            background-color: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-code"></i> CodeForge AI</h1>
                    <p class="lead mb-0">Generate high-quality, production-ready code with AI</p>
                </div>
                <div class="col-md-4 text-end">
                    <span class="badge bg-light text-dark">v1.3.0</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="row mb-5">
            <div class="col-md-4 mb-4">
                <div class="card h-100 p-4">
                    <div class="feature-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h5>Instant Code Generation</h5>
                    <p class="text-muted">Transform your ideas into working code in seconds with our advanced AI model.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 p-4">
                    <div class="feature-icon">
                        <i class="fas fa-code-branch"></i>
                    </div>
                    <h5>Multiple Languages</h5>
                    <p class="text-muted">Generate code in JavaScript, TypeScript, Python, Java, and many more languages.</p>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 p-4">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5>Best Practices</h5>
                    <p class="text-muted">All generated code follows industry best practices and modern coding standards.</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-5">
                <div class="card mb-4">
                    <div class="card-header bg-white">
                        <h5 class="mb-0">Generate Code</h5>
                    </div>
                    <div class="card-body">
                        <form id="codeGeneratorForm">
                            <div class="mb-3">
                                <label for="languageDisplay" class="form-label">Programming Language</label>
                                <div class="language-select-container">
                                    <input type="text" id="languageDisplay" class="form-control" placeholder="Search for a language..." autocomplete="off">
                                    <input type="hidden" id="languageSelect">
                                    <div id="languageList" class="language-list">
                                        <!-- Languages will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="modelSelect" class="form-label">AI Model</label>
                                <select id="modelSelect" class="form-select">
                                    <option value="">Loading models...</option>
                                </select>
                                <div class="form-text">Choose a model for code generation. More powerful models may generate better code.</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="promptInput" class="form-label">What do you want to build?</label>
                                <textarea id="promptInput" class="form-control" rows="5" placeholder="Describe the code you want to generate..."></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label mb-0">Project File (Optional)</label>
                                    <small class="text-muted">Optional</small>
                                </div>
                                <div class="input-group mb-1">
                                    <input type="file" class="form-control" id="projectFile">
                                </div>
                                <div class="form-text">Upload a file containing project structure or coding standards</div>
                            </div>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="includeTests">
                                <label class="form-check-label" for="includeTests">Include Unit Tests</label>
                            </div>
                            
                            <button type="submit" id="generateButton" class="btn btn-primary w-100 py-2 mt-3">
                                <span id="generateSpinner" class="loader hidden"></span>
                                Generate Code
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="card mb-4" id="downloadCard" style="display: none;">
                    <div class="card-body">
                        <h5 class="card-title">Download Your Code</h5>
                        <p class="card-text">Your code has been generated successfully. You can download it now.</p>
                        <a id="downloadLink" href="#" class="btn btn-success w-100">
                            <i class="fas fa-download"></i> Download Code
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-7">
                <div class="code-editor mb-4">
                    <div class="code-header">
                        <div>
                            <i class="fas fa-code"></i>
                            <span id="codeFilename">output.js</span>
                        </div>
                        <span id="languageBadge" class="language-badge">javascript</span>
                    </div>
                    <div class="code-body">
                        <pre><code id="codeOutput" class="language-javascript">// Your generated code will appear here</code></pre>
                    </div>
                </div>
                
                <div id="folderStructureSection" style="display: none;" class="mb-4">
                    <h5>Folder Structure</h5>
                    <pre id="folderStructure"></pre>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">Â© 2023 CodeForge AI. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="#" class="text-muted me-3">Terms of Service</a>
                    <a href="#" class="text-muted">Privacy Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const codeGeneratorForm = document.getElementById('codeGeneratorForm');
            const generateButton = document.getElementById('generateButton');
            const generateSpinner = document.getElementById('generateSpinner');
            const codeOutput = document.getElementById('codeOutput');
            const languageBadge = document.getElementById('languageBadge');
            const languageSelect = document.getElementById('languageSelect');
            const languageDisplay = document.getElementById('languageDisplay');
            const languageList = document.getElementById('languageList');
            const modelSelect = document.getElementById('modelSelect');
            const codeFilename = document.getElementById('codeFilename');
            const downloadCard = document.getElementById('downloadCard');
            const downloadLink = document.getElementById('downloadLink');
            const folderStructureSection = document.getElementById('folderStructureSection');
            const folderStructure = document.getElementById('folderStructure');
            
            // Store languages data
            let languages = [];

            // Fetch available languages and models when the page loads
            fetchAvailableLanguages();
            fetchAvailableModels();

            // Language selection functionality
            languageDisplay.addEventListener('focus', function() {
                languageList.classList.add('show');
            });
            
            languageDisplay.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                filterLanguageList(searchTerm);
            });
            
            document.addEventListener('click', function(e) {
                if (!languageDisplay.contains(e.target) && !languageList.contains(e.target)) {
                    languageList.classList.remove('show');
                }
            });
            
            function selectLanguage(name, hljs, extension) {
                languageSelect.value = name;
                languageDisplay.value = name;
                languageBadge.textContent = hljs;
                codeOutput.className = 'language-' + hljs;
                codeFilename.textContent = `output.${extension}`;
                hljs.highlightElement(codeOutput);
                languageList.classList.remove('show');
            }
            
            function filterLanguageList(searchTerm) {
                const items = languageList.querySelectorAll('.language-item');
                let hasMatches = false;
                
                items.forEach(item => {
                    const langName = item.textContent.toLowerCase();
                    if (langName.includes(searchTerm)) {
                        item.style.display = 'block';
                        hasMatches = true;
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                // Show or hide the language list based on matches
                if (hasMatches) {
                    languageList.classList.add('show');
                } else {
                    languageList.classList.remove('show');
                }
                
                // Adjust category display
                const categories = languageList.querySelectorAll('.language-category');
                categories.forEach(category => {
                    const nextItems = [];
                    let sibling = category.nextElementSibling;
                    
                    while (sibling && !sibling.classList.contains('language-category')) {
                        nextItems.push(sibling);
                        sibling = sibling.nextElementSibling;
                    }
                    
                    const hasVisibleItems = nextItems.some(item => item.style.display !== 'none');
                    category.style.display = hasVisibleItems ? 'block' : 'none';
                });
            }

            // Update when language selection changes
            function updateLanguageDisplay(language) {
                const selectedLanguage = languages.find(lang => lang.name === language);
                if (selectedLanguage) {
                    languageBadge.textContent = selectedLanguage.hljs;
                    codeOutput.className = 'language-' + selectedLanguage.hljs;
                    codeFilename.textContent = `output.${selectedLanguage.extension}`;
                    hljs.highlightElement(codeOutput);
                }
            }

            codeGeneratorForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const promptInput = document.getElementById('promptInput').value;
                const language = languageSelect.value;
                const model = modelSelect.value;
                const includeTests = document.getElementById('includeTests').checked;
                const projectFile = document.getElementById('projectFile').files[0];
                
                if (!promptInput) {
                    alert('Please enter a prompt for code generation.');
                    return;
                }
                
                if (!language) {
                    alert('Please select a programming language.');
                    return;
                }
                
                if (!model) {
                    alert('Please select an AI model.');
                    return;
                }
                
                // Show loading state
                generateButton.disabled = true;
                generateSpinner.classList.remove('hidden');
                codeOutput.textContent = 'Generating your code...';
                
                try {
                    let projectFileContent = null;
                    
                    // Upload project file if provided (optional)
                    if (projectFile) {
                        const formData = new FormData();
                        formData.append('projectFile', projectFile);
                        
                        const uploadResponse = await fetch('http://localhost:5000/api/upload-project-file', {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!uploadResponse.ok) {
                            throw new Error('Failed to upload project file');
                        }
                        
                        const uploadData = await uploadResponse.json();
                        projectFileContent = uploadData.fileContent;
                    }
                    
                    // Generate code
                    const response = await fetch('http://localhost:5000/api/generate-code', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: promptInput,
                            language: language,
                            model: model,
                            includeTests: includeTests,
                            projectFile: projectFileContent
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Code generation failed');
                    }
                    
                    const data = await response.json();
                    
                    // Update UI with the generated code
                    codeOutput.textContent = data.code;
                    codeOutput.className = 'language-' + language.toLowerCase();
                    hljs.highlightElement(codeOutput);
                    
                    // Update file name
                    codeFilename.textContent = data.filename;
                    
                    // Show download button
                    downloadCard.style.display = 'block';
                    downloadLink.href = `http://localhost:5000/api/download-code?filename=${data.filename}`;
                    
                    // Show folder structure if available
                    if (data.folderStructure) {
                        folderStructureSection.style.display = 'block';
                        folderStructure.textContent = JSON.stringify(data.folderStructure, null, 2);
                    }
                    
                } catch (error) {
                    codeOutput.textContent = `Error: ${error.message}`;
                } finally {
                    // Reset loading state
                    generateButton.disabled = false;
                    generateSpinner.classList.add('hidden');
                }
            });
            
            // Fetch available languages from the backend
            async function fetchAvailableLanguages() {
                try {
                    const response = await fetch('http://localhost:5000/api/languages');
                    
                    if (!response.ok) {
                        throw new Error('Failed to fetch languages');
                    }
                    
                    const data = await response.json();
                    languages = data.languages;
                    
                    // Populate the language list
                    populateLanguageList(languages);
                    
                    // Set default language (JavaScript)
                    const defaultLanguage = languages.find(lang => lang.name === 'JavaScript');
                    if (defaultLanguage) {
                        selectLanguage(defaultLanguage.name, defaultLanguage.hljs, defaultLanguage.extension);
                    }
                    
                } catch (error) {
                    console.error('Error fetching languages:', error);
                    // Fallback to a simple dropdown if API fails
                    const basicLanguages = [
                        { name: "JavaScript", hljs: "javascript", extension: "js" },
                        { name: "Python", hljs: "python", extension: "py" },
                        { name: "Java", hljs: "java", extension: "java" }
                    ];
                    populateLanguageList(basicLanguages);
                }
            }
            
            function populateLanguageList(languages) {
                // Clear existing list
                languageList.innerHTML = '';
                
                // Add popular languages first
                if (languages.some(lang => lang.popular)) {
                    const popularCategory = document.createElement('div');
                    popularCategory.className = 'language-category';
                    popularCategory.textContent = 'Popular Languages';
                    languageList.appendChild(popularCategory);
                    
                    languages.filter(lang => lang.popular).forEach(lang => {
                        addLanguageToList(lang, true);
                    });
                }
                
                // Add "All Languages" category
                const allCategory = document.createElement('div');
                allCategory.className = 'language-category';
                allCategory.textContent = 'All Languages';
                languageList.appendChild(allCategory);
                
                // Add all languages
                languages.forEach(lang => {
                    addLanguageToList(lang, false);
                });
            }
            
            function addLanguageToList(language, skipIfPopular) {
                // Skip if this is in the "All Languages" section and the language is already in "Popular"
                if (skipIfPopular && language.popular) return;
                
                const item = document.createElement('div');
                item.className = 'language-item';
                if (language.popular) item.classList.add('popular');
                item.textContent = language.name;
                item.setAttribute('data-hljs', language.hljs);
                item.setAttribute('data-extension', language.extension);
                
                item.addEventListener('click', function() {
                    selectLanguage(language.name, language.hljs, language.extension);
                });
                
                languageList.appendChild(item);
            }
            
            // Fetch available models from the backend
            async function fetchAvailableModels() {
                try {
                    const response = await fetch('http://localhost:5000/api/models');
                    
                    if (!response.ok) {
                        throw new Error('Failed to fetch models');
                    }
                    
                    const data = await response.json();
                    
                    // Clear the loading option
                    modelSelect.innerHTML = '';
                    
                    if (data.models && data.models.length > 0) {
                        // Add models to the dropdown
                        data.models.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model.id;
                            option.textContent = model.id;
                            modelSelect.appendChild(option);
                        });
                        
                        // Set default to gpt-4-turbo if available, or the first model
                        const defaultModel = data.models.find(m => m.id === 'gpt-4-turbo') || data.models[0];
                        modelSelect.value = defaultModel.id;
                    } else {
                        // If no models are available, provide a default option
                        const option = document.createElement('option');
                        option.value = 'gpt-4-turbo';
                        option.textContent = 'gpt-4-turbo (Default)';
                        modelSelect.appendChild(option);
                    }
                } catch (error) {
                    console.error('Error fetching models:', error);
                    
                    // Set some default options in case of error
                    modelSelect.innerHTML = `
                        <option value="gpt-4-turbo">gpt-4-turbo (Default)</option>
                        <option value="gpt-4">gpt-4</option>
                        <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
                    `;
                }
            }
            
            // Initialize syntax highlighting
            hljs.highlightElement(codeOutput);
        });
    </script>
</body>
</html>
